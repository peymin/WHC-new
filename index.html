<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix And Flip Wholesale Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #F7F9FB;
            margin: 0;
            padding: 0;
            display: flex;
            min-height: 100vh;
        }

        .container {
            display: flex;
            width: 100%;
        }

        .sidebar {
            width: 200px;
            background: #FFFFFF;
            padding: 24px;
            color: #000000;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            overflow-y: auto;
        }

        .sidebar a {
            display: block;
            padding: 12px 16px;
            color: #000000;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
            border-radius: 6px;
            transition: background-color 0.2s, color 0.2s;
        }

        .sidebar a:hover {
            background-color: #F1F3F5;
            color: #000000;
        }

        .sidebar a.active {
            background-color: #FFCC00;
            color: #FFFFFF;
        }

        .sidebar a.cash,
        .sidebar a.creative {
            font-size: 18px;
            font-weight: 700;
            color: #FFCC00;
            margin: 16px 0 8px;
            padding: 8px 16px;
            pointer-events: none;
        }

        .logo-container img {
            max-width: 100%;
            height: auto;
            display: block;
        }

        .main-content {
            flex: 1;
            margin-left: 200px;
            padding: 32px 0;
            background-color: #F7F9FB;
        }

        .header {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 24px;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 500;
            color: #1D2939;
            text-align: center;
        }

        .tab-content {
            background: #FAFAFA;
            padding: 24px;
            max-width: 900px;
            margin: 0 auto;
        }

        .tab-content.active {
            display: block;
        }

        form {
            width: 100%;
        }

        .section-card {
            margin-bottom: 24px;
        }

        fieldset {
            border: none;
            padding: 0;
        }

        legend {
            font-size: 16px;
            font-weight: 500;
            color: #1D2939;
            margin-bottom: 16px;
        }

        fieldset.collapsible legend {
            cursor: pointer;
            display: flex;
            align-items: center;
            padding: 12px 16px;
            background: #F9FAFB;
            border: 1px solid #E4E7EC;
            border-radius: 6px;
            width: 100%;
            transition: background-color 0.2s;
        }

        fieldset.collapsible legend:hover {
            background: #F1F3F5;
        }

        fieldset.collapsible legend::before {
            content: '';
            width: 16px;
            height: 16px;
            margin-right: 8px;
            background: url('images/right-arrow.png') no-repeat center;
            background-size: contain;
            transition: transform 0.3s;
        }

        fieldset.collapsible:not(.collapsed) legend::before {
            background: url('images/down-arrow.png') no-repeat center;
            background-size: contain;
        }

        .collapsible-content {
            display: none;
            padding: 16px;
        }

        fieldset.collapsible:not(.collapsed) .collapsible-content {
            display: block;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            font-size: 12px;
            font-weight: 500;
            color: #344054;
            margin-bottom: 6px;
        }

        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group select {
            width: 100%;
            max-width: 200px;
            padding: 10px 12px;
            border: 1px solid #D0D5DD;
            border-radius: 6px;
            font-size: 14px;
            background: #FFFFFF;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .form-group input[type="text"]:focus,
        .form-group input[type="number"]:focus,
        .form-group select:focus {
            border-color: #F6C107;
            box-shadow: 0 0 0 3px rgba(246, 193, 7, 0.1);
            outline: none;
        }

        .form-group input[readonly] {
            background-color: #FFFFFF;
            border: 2px solid #E4E7EC;
            cursor: not-allowed;
        }

        .form-group .percent-input-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
            max-width: 100px;
        }

        .form-group .percent-input-wrapper input[type="number"],
        .form-group input[type="number"]#holdingPeriodDays {
            width: 100%;
            padding: 10px 12px;
            -webkit-appearance: textfield;
            -moz-appearance: textfield;
            appearance: textfield;
        }

        .form-group .percent-input-wrapper input[type="number"]::-webkit-inner-spin-button,
        .form-group .percent-input-wrapper input[type="number"]::-webkit-outer-spin-button,
        .form-group input[type="number"]#holdingPeriodDays::-webkit-inner-spin-button,
        .form-group input[type="number"]#holdingPeriodDays::-webkit-outer-spin-button {
            -webkit-appearance: inner-spin-button;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .form-group .percent-input-wrapper input[type="number"]:hover::-webkit-inner-spin-button,
        .form-group .percent-input-wrapper input[type="number"]:hover::-webkit-outer-spin-button,
        .form-group input[type="number"]#holdingPeriodDays:hover::-webkit-inner-spin-button,
        .form-group input[type="number"]#holdingPeriodDays:hover::-webkit-outer-spin-button {
            opacity: 1;
        }

        .checkbox-group {
            margin-bottom: 16px;
        }

        .checkbox-group h3 {
            font-size: 14px;
            font-weight: 500;
            color: #1D2939;
            margin-bottom: 8px;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            font-size: 14px;
            color: #344054;
            margin-bottom: 8px;
            cursor: pointer;
        }

        input[type="checkbox"] {
            appearance: none;
            width: 18px;
            height: 18px;
            border: 2px solid #cacfd2;
            border-radius: 4px;
            margin-right: 8px;
            position: relative;
            cursor: pointer;
            background-color: #FFFFFF;
            flex-shrink: 0;
        }

        input[type="checkbox"]:checked {
            background-color: #F6C107;
            border-color: #F6C107;
        }

        input[type="checkbox"]:checked::after {
            content: '';
            position: absolute;
            top: 40%;
            left: 50%;
            width: 6px;
            height: 10px;
            border: solid #FFFFFF;
            border-width: 0 2px 2px 0;
            transform: translate(-50%, -50%) rotate(45deg);
        }

        .repair-checkbox-group {
            display: flex;
            flex-direction: row;
            gap: 24px;
            flex-wrap: nowrap;
            margin-bottom: 16px;
        }

        .repair-checkbox-group label {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 0;
            min-width: 80px;
        }

        .repair-checkbox-group label span {
            font-size: 12px;
            color: #344054;
            text-align: center;
            margin-top: 4px;
        }

        .location-group {
            display: flex;
            gap: 16px;
            margin-bottom: 16px;
        }

        .location-group label {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 12px;
            color: #344054;
        }

        .location-group input[type="checkbox"] {
            margin-top: 8px;
        }

        .sub-section {
            padding: 16px;
            background: #F9FAFB;
            border-radius: 6px;
            margin-top: 16px;
        }

        select {
            appearance: none;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="%23667085" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>') no-repeat right 12px center;
            background-size: 16px;
        }

        .property-info-container {
            display: flex;
            gap: 24px;
            flex-wrap: wrap;
        }

        .location-estimator,
        .market-condition {
            flex: 1;
            min-width: 280px;
        }

        .market-condition input[type="range"] {
            width: 300px;
            height: 6px;
            background: #E4E7EC;
            border-radius: 5px;
            outline: none;
            -webkit-appearance: none;
        }

        .market-condition input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: #F6C107;
            border-radius: 50%;
            cursor: pointer;
        }

        .market-condition input[type="range"]::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #F6C107;
            border-radius: 50%;
            cursor: pointer;
        }

        .emoji-container {
            display: flex;
            justify-content: space-between;
            width: 300px;
            margin-top: 8px;
            font-size: 20px;
        }

        .emoji-container img {
            width: 30px;
            height: 30px;
            vertical-align: middle;
        }

        .emoji-labels {
            display: flex;
            justify-content: space-between;
            width: 300px;
            margin-top: 4px;
            font-size: 12px;
            color: #667085;
        }

        .emoji-labels span {
            flex: none;
            text-align: center;
            width: auto;
            padding: 0 10px;
        }

        .emoji-labels span:first-child {
            margin-left: -10px;
        }

        .emoji-labels span:nth-child(2) {
            margin: 0;
        }

        .emoji-labels span:last-child {
            margin-right: -10px;
        }

        .smart-adjustments-container {
            display: block;
        }

        .smart-adjustments-row {
            display: flex;
            gap: 24px;
            flex-wrap: wrap;
            margin-bottom: 16px;
        }

        .smart-adjustments-row .form-group {
            flex: 1;
            min-width: 280px;
        }

        .adjustment-group {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 8px;
        }

        .adjustment-group input[type="text"] {
            width: 120px;
        }

        .adjustment-group input[type="text"].error {
            border-color: #D92D20;
            box-shadow: 0 0 0 3px rgba(217, 45, 32, 0.1);
        }

        .custom-checkbox {
            display: flex;
            align-items: center;
        }

        .adjustment-summary,
        .mao-iao-container,
        .offer-container,
        .dispo-container,
        .dispo-jv-group,
        .costs-container,
        .booty-container,
        .pre-assignment-profit-container,
        .cash-scorecard-container {
            display: flex;
            gap: 24px;
            flex-wrap: wrap;
        }

        .property-info-row {
            display: flex;
            gap: 24px;
            flex-wrap: wrap;
        }

        .property-info-row.tight-row {
            gap: 12px;
        }

        .buttons-section {
            text-align: center;
            margin: 24px 0;
        }

        .gold-button {
            background: linear-gradient(90deg, #F6C107 0%, #E6A700 100%);
            color: #1D2939;
            border: none;
            padding: 12px 24px;
            font-size: 14px;
            font-weight: 500;
            border-radius: 6px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .gold-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .gold-button:active {
            transform: translateY(0);
        }

        .gold-label {
            background: linear-gradient(90deg, #F6C107 0%, #E6A700 100%);
            color: #1D2939;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 500;
            border-radius: 6px;
            display: inline-block;
            margin-bottom: 16px;
        }

        fieldset.hidden {
            display: none;
        }

        .positive {
            background-color: #D4EDDA !important;
        }

        .midrange {
            background-color: #E2E3E5 !important;
        }

        .negative {
            background-color: #F8D7DA !important;
        }

        .blank {
            background-color: #FFFFFF !important;
        }

        .footnote {
            font-size: 12px;
            color: #667085;
            margin-top: 4px;
        }

        .error-message {
            color: #D92D20;
            font-size: 12px;
            margin-top: 4px;
            display: none;
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 160px;
            }

            .main-content {
                margin-left: 160px;
                padding: 16px 0;
            }

            .smart-adjustments-row {
                flex-direction: column;
                gap: 16px;
            }

            .smart-adjustments-row .form-group {
                min-width: 100%;
            }

            .repair-checkbox-group {
                flex-wrap: wrap;
            }

            .emoji-container,
            .emoji-labels,
            .market-condition input[type="range"] {
                width: 100%;
                max-width: 300px;
            }

            .emoji-labels span {
                padding: 0 5px;
            }

            .emoji-labels span:first-child,
            .emoji-labels span:last-child {
                margin: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="logo-container">
                <img src="images/logo.jpg" alt="Wholesale Calculators Logo">
            </div>
            <div class="nav-section">
                <a href="#" class="cash">Cash</a>
                <a href="./index.html" class="nav-item active">Fix And Flip</a>
                <a href="./Land.html" class="nav-item">Land</a>
                <a href="./Rental.html" class="nav-item">Rental</a>
            </div>
            <div class="nav-section">
                <a href="#" class="creative">Creative</a>
                <a href="./Subject-To.html" class="nav-item">Subject To</a>
                <a href="./Seller-Finance.html" class="nav-item">Seller Finance</a>
                <a href="./Novation.html" class="nav-item">Novation</a>
            </div>
        </div>

        <div class="main-content">
            <div class="header">
                <h1>Fix And Flip Wholesale Calculator</h1>
            </div>
            <div id="single-family" class="tab-content active">
                <form id="calcForm">
                    <fieldset class="section-card">
                        <legend>Property Information</legend>
                        <div class="property-info-row">
                            <div class="form-group">
                                <label for="address">Address</label>
                                <input type="text" id="address" name="address" required>
                            </div>
                            <div class="form-group"></div>
                            <div class="form-group"></div>
                        </div>
                        <div class="property-info-row tight-row">
                            <div class="form-group">
                                <label for="price">Seller's Price</label>
                                <input type="text" id="price" name="price" required>
                            </div>
                            <div class="form-group">
                                <label for="arv">ARV *</label>
                                <input type="text" id="arv" name="arv" required>
                            </div>
                            <div class="form-group"></div>
                        </div>
                        <div class="property-info-container">
                            <div class="location-estimator">
                                <fieldset class="inner-card">
                                    <legend>Location Estimator</legend>
                                    <div class="location-group">
                                        <label>
                                            Bad Area
                                            <input type="checkbox" id="badArea" name="locationCondition" value="bad_area">
                                        </label>
                                        <label>
                                            Good Area
                                            <input type="checkbox" id="goodArea" name="locationCondition" value="good_area">
                                        </label>
                                        <label>
                                            Best Area
                                            <input type="checkbox" id="bestArea" name="locationCondition" value="best_area">
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label for="percentArv">% of ARV *</label>
                                        <div class="percent-input-wrapper">
                                            <input type="number" id="percentArv" name="percentArv" step="0.5" min="0" max="100">
                                        </div>
                                    </div>
                                </fieldset>
                            </div>
                            <div class="market-condition">
                                <fieldset class="inner-card">
                                    <legend>Market Condition</legend>
                                    <div class="form-group">
                                        <input type="range" id="marketCondition" name="marketCondition" min="0" max="100" step="50" value="50">
                                    </div>
                                    <div class="emoji-container">
                                        <img src="images/4.png" alt="Cold Market">
                                        <img src="images/5.png" alt="Neutral Market">
                                        <img src="images/6.png" alt="Hot Market">
                                    </div>
                                    <div class="emoji-labels">
                                        <span>Cold Market</span>
                                        <span>Neutral Market</span>
                                        <span>Hot Market</span>
                                    </div>
                                </fieldset>
                            </div>
                        </div>
                    </fieldset>

                    <fieldset class="section-card collapsible collapsed">
                        <legend>Repair Estimator</legend>
                        <div class="collapsible-content">
                            <div class="form-group">
                                <label for="sqft">Sq Ft</label>
                                <input type="number" id="sqft" name="square_feet" step="any">
                            </div>
                            <div class="repair-checkbox-group">
                                <label><input type="checkbox" id="smoothSailing" name="repairCondition" value="smoothSailing"><span>Turnkey</span></label>
                                <label><input type="checkbox" id="shiverMeetsRepair" name="repairCondition" value="shiverMeetsRepair"><span>Light Rehab</span></label>
                                <label><input type="checkbox" id="abandonShip" name="repairCondition" value="abandonShip"><span>Medium Rehab</span></label>
                                <label><input type="checkbox" id="burnTheShip" name="repairCondition" value="burnTheShip"><span>Heavy Rehab</span></label>
                            </div>
                            <div class="sub-section">
                                <div class="form-group">
                                    <label for="repairCost">Cost / sq ft</label>
                                    <input type="text" id="repairCost" name="repairCost">
                                </div>
                                <div class="form-group">
                                    <label for="repairDays">Repair Days</label>
                                    <input type="number" id="repairDays" name="repairDays" step="any">
                                </div>
                                <div class="form-group">
                                    <label for="majorItems"># of Major Repair Items</label>
                                    <select id="majorItems" name="majorItems">
                                        <option value="0" selected>0</option>
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                    </select>
                                </div>
                                <div id="extraField" class="form-group" style="display: none;">
                                    <label for="extraValue">Cost per Item</label>
                                    <input type="text" id="extraValue" name="extraValue">
                                </div>
                            </div>
                        </div>
                    </fieldset>
                    <div class="form-group">
                        <label for="repairs">Repairs</label>
                        <input type="text" id="repairs" name="repairs">
                    </div>

                    <fieldset class="section-card collapsible collapsed">
                        <legend>Smart Adjustments</legend>
                        <div class="collapsible-content">
                            <div class="smart-adjustments-container">
                                <div class="smart-adjustments-row">
                                    <div class="form-group">
                                        <label>Traffic / Commercial</label>
                                        <div class="repair-checkbox-group">
                                            <label class="custom-checkbox">
                                                <input type="checkbox" name="trafficCommercial" value="na">
                                                <span>N/A</span>
                                            </label>
                                            <label class="custom-checkbox">
                                                <input type="checkbox" name="trafficCommercial" value="backs">
                                                <span>Backs</span>
                                            </label>
                                            <label class="custom-checkbox">
                                                <input type="checkbox" name="trafficCommercial" value="sides">
                                                <span>Sides</span>
                                            </label>
                                            <label class="custom-checkbox">
                                                <input type="checkbox" name="trafficCommercial" value="fronts">
                                                <span>Fronts</span>
                                            </label>
                                        </div>
                                        <div class="adjustment-group">
                                            <input type="text" id="trafficCommercialAdjustment" placeholder="$0" readonly>
                                        </div>
                                        <div id="trafficCommercialError" class="error-message">Please enter a value for ARV</div>
                                    </div>
                                    <div class="form-group"></div>
                                </div>
                                <div class="smart-adjustments-row">
                                    <div class="form-group">
                                        <label>Bedroom</label>
                                        <div class="adjustment-group">
                                            <label class="custom-checkbox">
                                                <input type="checkbox" name="bedroom" value="shortage">
                                                <span class="checkbox-text">Shortage</span>
                                            </label>
                                            <label class="custom-checkbox">
                                                <input type="checkbox" name="bedroom" value="additional">
                                                <span class="checkbox-text">Additional</span>
                                            </label>
                                            <input type="text" id="bedroomAdjustment" placeholder="$0" readonly>
                                        </div>
                                        <div id="bedroomError" class="error-message">Please enter a value for ARV</div>
                                    </div>
                                    <div class="form-group">
                                        <label>Bathroom</label>
                                        <div class="adjustment-group">
                                            <label class="custom-checkbox">
                                                <input type="checkbox" name="bathroom" value="shortage">
                                                <span class="checkbox-text">Shortage</span>
                                            </label>
                                            <label class="custom-checkbox">
                                                <input type="checkbox" name="bathroom" value="additional">
                                                <span class="checkbox-text">Additional</span>
                                            </label>
                                            <input type="text" id="bathroomAdjustment" placeholder="$0" readonly>
                                        </div>
                                        <div id="bathroomError" class="error-message">Please enter a value for ARV</div>
                                    </div>
                                </div>
                                <div class="smart-adjustments-row">
                                    <div class="form-group">
                                        <label>Garage</label>
                                        <div class="adjustment-group">
                                            <label class="custom-checkbox">
                                                <input type="checkbox" name="garage" value="shortage">
                                                <span class="checkbox-text">Shortage</span>
                                            </label>
                                            <label class="custom-checkbox">
                                                <input type="checkbox" name="garage" value="additional">
                                                <span class="checkbox-text">Additional</span>
                                            </label>
                                            <input type="text" id="garageAdjustment" placeholder="$0" readonly>
                                        </div>
                                        <div id="garageError" class="error-message">Please enter a value for ARV</div>
                                    </div>
                                    <div class="form-group">
                                        <label>Carport</label>
                                        <div class="adjustment-group">
                                            <label class="custom-checkbox">
                                                <input type="checkbox" name="carport" value="shortage">
                                                <span class="checkbox-text">Shortage</span>
                                            </label>
                                            <label class="custom-checkbox">
                                                <input type="checkbox" name="carport" value="additional">
                                                <span class="checkbox-text">Additional</span>
                                            </label>
                                            <input type="text" id="carportAdjustment" placeholder="$0" readonly>
                                        </div>
                                        <div id="carportError" class="error-message">Please enter a value for ARV</div>
                                    </div>
                                </div>
                                <div class="smart-adjustments-row">
                                    <div class="form-group">
                                        <label>Pool</label>
                                        <div class="adjustment-group">
                                            <label class="custom-checkbox">
                                                <input type="checkbox" name="pool" value="shortage">
                                                <span class="checkbox-text">Shortage</span>
                                            </label>
                                            <label class="custom-checkbox">
                                                <input type="checkbox" name="pool" value="additional">
                                                <span class="checkbox-text">Additional</span>
                                            </label>
                                            <input type="text" id="poolAdjustment" placeholder="$0" readonly>
                                        </div>
                                        <div id="poolError" class="error-message">Please enter a value for ARV</div>
                                    </div>
                                    <div class="form-group"></div>
                                </div>
                            </div>
                            <div class="adjustment-summary">
                                <div class="form-group">
                                    <label for="totalAdjustment">Total Adjustments</label>
                                    <input type="text" id="totalAdjustment" name="totalAdjustment" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="adjustedArv">Adjusted ARV</label>
                                    <input type="text" id="adjustedArv" name="adjustedArv" readonly>
                                </div>
                            </div>
                        </div>
                    </fieldset>

                    <div class="mao-iao-container">
                        <div class="form-group">
                            <label for="mao">MAO *</label>
                            <input type="text" id="mao" name="mao" readonly>
                            <div class="footnote" id="priceFootnote"></div>
                            <div class="footnote" id="pricingMessage"></div>
                        </div>
                        <div class="form-group">
                            <label for="iao">X Offer *</label>
                            <input type="text" id="iao" name="iao" readonly>
                        </div>
                    </div>

                    <fieldset class="section-card">
                        <legend>Dispo</legend>
                        <div class="dispo-container">
                            <div class="form-group">
                                <label for="contractedPrice">Contracted Price *</label>
                                <input type="text" id="contractedPrice" name="contractedPrice">
                            </div>
                            <div class="form-group">
                                <label for="investorPrice">Investor Price *</label>
                                <input type="text" id="investorPrice" name="investorPrice">
                            </div>
                            <div class="form-group">
                                <label for="assignmentFee">Assignment Fee *</label>
                                <input type="text" id="assignmentFee" name="assignmentFee" readonly>
                            </div>
                        </div>
                        <div class="dispo-jv-group">
                            <div class="form-group">
                                <label for="jvSplit">JV Split (%)</label>
                                <select id="jvSplit" name="jvSplit">
                                    <option value="" selected></option>
                                    <option value="100/0">100/0</option>
                                    <option value="90/10">90/10</option>
                                    <option value="80/20">80/20</option>
                                    <option value="70/30">70/30</option>
                                    <option value="60/40">60/40</option>
                                    <option value="50/50">50/50</option>
                                    <option value="40/60">40/60</option>
                                    <option value="30/70">30/70</option>
                                    <option value="20/80">20/80</option>
                                    <option value="10/90">10/90</option>
                                    <option value="0/100">0/100</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="yourAssignmentFee">Net Assignment Fee</label>
                                <input type="text" id="yourAssignmentFee" name="yourAssignmentFee" readonly>
                            </div>
                            <div class="form-group"></div>
                        </div>
                    </fieldset>

                    <div class="buttons-section">
                        <button type="button" class="gold-button" id="fireAway">Fire Away</button>
                    </div>

                    <fieldset id="costsSection" class="section-card hidden collapsible collapsed">
                        <legend>Costs</legend>
                        <div class="collapsible-content">
                            <div class="costs-container">
                                <div class="form-group">
                                    <label for="closingCostsBuyPercent">Closing Costs Buy (%)</label>
                                    <div class="percent-input-wrapper">
                                        <input type="number" id="closingCostsBuyPercent" name="closingCostsBuyPercent" step="0.5" min="0">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="closingCostsSellPercent">Closing Costs Sell (%)</label>
                                    <div class="percent-input-wrapper">
                                        <input type="number" id="closingCostsSellPercent" name="closingCostsSellPercent" step="0.5" min="0">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="closingCostsDollars">Closing Costs ($)</label>
                                    <input type="text" id="closingCostsDollars" name="closingCostsDollars">
                                </div>
                            </div>
                            <div class="costs-container">
                                <div class="form-group">
                                    <label for="buyerAgentCommissionPercent">Buyer Agent Commission (%)</label>
                                    <div class="percent-input-wrapper">
                                        <input type="number" id="buyerAgentCommissionPercent" name="buyerAgentCommissionPercent" step="0.5" min="0">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="listingAgentCommissionPercent">Listing Agent Commission (%)</label>
                                    <div class="percent-input-wrapper">
                                        <input type="number" id="listingAgentCommissionPercent" name="listingAgentCommissionPercent" step="0.5" min="0">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="agentCommissionsDollars">Agent Commissions ($)</label>
                                    <input type="text" id="agentCommissionsDollars" name="agentCommissionsDollars">
                                </div>
                            </div>
                            <div class="costs-container">
                                <div class="form-group">
                                    <label for="holdingPeriodDays">Holding Period (Days)</label>
                                    <input type="number" id="holdingPeriodDays" name="holdingPeriodDays" step="any">
                                </div>
                                <div class="form-group">
                                    <label for="holdingCostsDollars">Holding Costs ($)</label>
                                    <input type="text" id="holdingCostsDollars" name="holdingCostsDollars">
                                </div>
                                <div class="form-group"></div>
                            </div>
                            <div class="costs-container">
                                <div class="form-group">
                                    <label for="totalCosts">Total Costs</label>
                                    <input type="text" id="totalCosts" name="totalCosts" readonly>
                                </div>
                                <div class="form-group"></div>
                                <div class="form-group"></div>
                            </div>
                        </div>
                    </fieldset>

                    <fieldset id="bootySection" class="section-card hidden">
                        <legend>Buyer's Booty</legend>
                        <div class="booty-container">
                            <div class="form-group">
                                <label for="investorProfit">Investor Profit</label>
                                <input type="text" id="investorProfit" name="investorProfit" readonly>
                            </div>
                            <div class="form-group"></div>
                            <div class="form-group"></div>
                        </div>
                        <div class="booty-container">
                            <div class="form-group">
                                <label for="bootyMonthlyProfit">Monthly Profit</label>
                                <input type="text" id="bootyMonthlyProfit" name="bootyMonthlyProfit" readonly>
                            </div>
                            <div class="form-group">
                                <label for="bootyRoi">ROI</label>
                                <input type="text" id="bootyRoi" name="bootyRoi" readonly>
                            </div>
                            <div class="form-group">
                                <label for="bootyRjRatio">RJ Ratio</label>
                                <input type="text" id="bootyRjRatio" name="bootyRjRatio" readonly>
                            </div>
                        </div>
                    </fieldset>

                    <fieldset id="profitSection" class="section-card hidden collapsible collapsed">
                        <legend>Pre-Assignment Profit</legend>
                        <div class="collapsible-content">
                            <div class="pre-assignment-profit-container">
                                <div class="form-group">
                                    <label for="preAssignmentProfit">Profit</label>
                                    <input type="text" id="preAssignmentProfit" name="preAssignmentProfit" readonly>
                                </div>
                                <div class="form-group"></div>
                                <div class="form-group"></div>
                            </div>
                            <div class="pre-assignment-profit-container">
                                <div class="form-group">
                                    <label for="preAssignmentMonthlyProfit">Monthly Profit</label>
                                    <input type="text" id="preAssignmentMonthlyProfit" name="preAssignmentMonthlyProfit" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="preAssignmentRoi">ROI</label>
                                    <input type="text" id="preAssignmentRoi" name="preAssignmentRoi" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="preAssignmentRjRatio">RJ Ratio</label>
                                    <input type="text" id="preAssignmentRjRatio" name="preAssignmentRjRatio" readonly>
                                </div>
                            </div>
                        </div>
                    </fieldset>

                    <div id="cashScorecard" class="section-card">
                        <legend>Cash Scorecard</legend>
                        <div class="cash-scorecard-container">
                            <div class="form-group">
                                <label for="fixAndFlipScore">Fix and Flip Score</label>
                                <input type="text" id="fixAndFlipScore" name="fixAndFlipScore" readonly>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        let userHasInteracted = false;
        const dependentFields = [
            'repairs', 'arv', 'percentArv', 'price', 'investorPrice',
            'closingCostsBuyPercent', 'closingCostsSellPercent',
            'buyerAgentCommissionPercent', 'listingAgentCommissionPercent',
            'holdingPeriodDays', 'sqft', 'repairCost', 'extraValue',
            'trafficCommercialAdjustment', 'bedroomAdjustment',
            'bathroomAdjustment', 'garageAdjustment', 'carportAdjustment',
            'poolAdjustment'
        ];

        document.addEventListener('DOMContentLoaded', () => {
            try {
                console.log('DOM loaded, initializing form...');
                initializeForm();
                const collapsibleLegends = document.querySelectorAll('fieldset.collapsible legend');
                collapsibleLegends.forEach(legend => {
                    legend.addEventListener('click', handleCollapsibleClick);
                });
                const fireAwayButton = document.getElementById('fireAway');
                if (fireAwayButton) {
                    console.log('Attaching event listener to Fire Away button');
                    fireAwayButton.addEventListener('click', handleFireAwayClick);
                } else {
                    console.error('Fire Away button not found');
                }
                setupInputListeners();
            } catch (error) {
                console.error('Error in DOMContentLoaded:', error);
            }
        });

        function initializeForm() {
            try {
                console.log('Initializing form...');
                const allInputs = document.querySelectorAll('input[type="text"], input[type="number"], select');
                allInputs.forEach(input => {
                    if (input.type === 'number' || input.type === 'text') {
                        input.value = '';
                    } else if (input.tagName === 'SELECT') {
                        input.selectedIndex = 0;
                    }
                    input.classList.remove('positive', 'midrange', 'negative', 'blank');
                    input.dataset.manuallyEdited = 'false';
                });
                // Set default values for percentage fields
                const percentFields = [
                    'closingCostsBuyPercent', 'closingCostsSellPercent',
                    'buyerAgentCommissionPercent', 'listingAgentCommissionPercent'
                ];
                document.getElementById('closingCostsBuyPercent').value = '2';
                document.getElementById('closingCostsSellPercent').value = '2';
                document.getElementById('buyerAgentCommissionPercent').value = '3';
                document.getElementById('listingAgentCommissionPercent').value = '3';
                percentFields.forEach(id => {
                    const input = document.getElementById(id);
                    const value = parseFloat(input.value);
                    if (!isNaN(value)) {
                        input.value = value % 1 === 0 ? value.toString() : value.toFixed(1);
                    }
                });
                const checkboxes = document.querySelectorAll('input[type="checkbox"]');
                checkboxes.forEach(cb => cb.checked = false);
                document.getElementById('extraField').style.display = 'none';
                const collapsibleFieldsets = document.querySelectorAll('fieldset.collapsible');
                collapsibleFieldsets.forEach(fieldset => {
                    fieldset.classList.add('collapsed');
                    const content = fieldset.querySelector('.collapsible-content');
                    if (content) content.style.display = 'none';
                });
                ['costsSection', 'bootySection', 'profitSection'].forEach(id => {
                    const section = document.getElementById(id);
                    if (section) section.classList.add('hidden');
                });
                const pricingMessageDiv = document.getElementById('pricingMessage');
                if (pricingMessageDiv) {
                    pricingMessageDiv.textContent = '';
                    pricingMessageDiv.style.color = '#667085';
                }
                userHasInteracted = false;
                const scoreField = document.getElementById('fixAndFlipScore');
                if (scoreField) {
                    scoreField.value = '';
                }
                // Initialize error messages to be hidden
                const errorFields = document.querySelectorAll('.error-message');
                errorFields.forEach(error => error.style.display = 'none');
            } catch (error) {
                console.error('Error in initializeForm:', error);
            }
        }

        function handleCollapsibleClick(event) {
            try {
                const legend = event.currentTarget;
                const fieldset = legend.closest('fieldset.collapsible');
                if (fieldset) toggleCollapse(fieldset);
            } catch (error) {
                console.error('Error in handleCollapsibleClick:', error);
            }
        }

        function toggleCollapse(fieldset) {
            try {
                if (fieldset.classList.contains('collapsible')) {
                    const isCollapsed = fieldset.classList.toggle('collapsed');
                    const content = fieldset.querySelector('.collapsible-content');
                    if (content) {
                        content.style.display = isCollapsed ? 'none' : 'block';
                        console.log(`Toggled section ${fieldset.querySelector('legend').textContent}: ${isCollapsed ? 'Collapsed' : 'Expanded'}`);
                    }
                }
            } catch (error) {
                console.error('Error in toggleCollapse:', error);
            }
        }

        function handleFireAwayClick(event) {
            try {
                event.preventDefault(); // Prevent any default form submission
                console.log('Fire Away button clicked');
                handleFireAway();
            } catch (error) {
                console.error('Error in handleFireAwayClick:', error);
            }
        }

        function handleFireAway() {
            try {
                console.log('Handling Fire Away...');
                userHasInteracted = true; // Ensure userHasInteracted is set
                console.log('userHasInteracted set to true');
                toggleHiddenSections();
                updateAllFields(true);
                console.log('Fire Away completed');
            } catch (error) {
                console.error('Error in handleFireAway:', error);
            }
        }

        function toggleHiddenSections() {
            try {
                console.log('Toggling hidden sections...');
                const sections = ['costsSection', 'bootySection', 'profitSection'];
                sections.forEach(id => {
                    const section = document.getElementById(id);
                    if (section) {
                        console.log(`Unhiding section: ${id}`);
                        section.classList.remove('hidden');
                        section.style.display = 'block'; // Explicitly set display to block
                        if (section.classList.contains('collapsible') && section.classList.contains('collapsed')) {
                            console.log(`Expanding collapsible section: ${id}`);
                            section.classList.remove('collapsed');
                            const content = section.querySelector('.collapsible-content');
                            if (content) {
                                content.style.display = 'block';
                                console.log(`Collapsible content for ${id} set to display: block`);
                            }
                        }
                    } else {
                        console.warn(`Section ${id} not found`);
                    }
                });
            } catch (error) {
                console.error('Error in toggleHiddenSections:', error);
            }
        }

        function setupInputListeners() {
            try {
                const monetaryFields = [
                    'price', 'arv', 'repairs', 'assignmentFee', 'contractedPrice',
                    'investorPrice', 'mao', 'yourAssignmentFee', 'iao',
                    'adjustedArv', 'totalAdjustment', 'closingCostsDollars',
                    'agentCommissionsDollars', 'holdingCostsDollars', 'totalCosts',
                    'investorProfit', 'bootyMonthlyProfit', 'preAssignmentProfit',
                    'trafficCommercialAdjustment', 'bedroomAdjustment',
                    'bathroomAdjustment', 'garageAdjustment', 'carportAdjustment', 'poolAdjustment',
                    'extraValue'
                ];
                monetaryFields.forEach(id => {
                    const input = document.getElementById(id);
                    if (input && !input.hasAttribute('readonly')) {
                        input.addEventListener('input', () => {
                            userHasInteracted = true;
                            let value = input.value.replace(/[$,]/g, '');
                            if (!isNaN(value) && value !== '') {
                                value = parseFloat(value);
                                input.value = formatCurrency(value);
                            } else {
                                input.value = '';
                            }
                            input.dataset.manuallyEdited = 'true';
                            updateAllFields(dependentFields.includes(id));
                        });
                    }
                });

                const percentFields = [
                    'closingCostsBuyPercent', 'closingCostsSellPercent',
                    'buyerAgentCommissionPercent', 'listingAgentCommissionPercent'
                ];
                percentFields.forEach(id => {
                    const input = document.getElementById(id);
                    if (input) {
                        input.addEventListener('input', () => {
                            userHasInteracted = true;
                            const value = parseFloat(input.value);
                            if (!isNaN(value)) {
                                input.value = value % 1 === 0 ? value.toString() : value.toFixed(1);
                            }
                            input.dataset.manuallyEdited = 'true';
                            updateAllFields(true);
                        });
                    }
                });

                const inputsToTrack = [
                    'repairs', 'investorPrice', 'contractedPrice',
                    'closingCostsDollars', 'agentCommissionsDollars', 'holdingCostsDollars',
                    'trafficCommercialAdjustment', 'bedroomAdjustment',
                    'bathroomAdjustment', 'garageAdjustment', 'carportAdjustment', 'poolAdjustment',
                    'holdingPeriodDays', 'extraValue', 'sqft', 'repairCost'
                ];
                inputsToTrack.forEach(id => {
                    const input = document.getElementById(id);
                    if (input) {
                        input.addEventListener('input', () => {
                            userHasInteracted = true;
                            input.dataset.manuallyEdited = 'true';
                            updateAllFields(dependentFields.includes(id));
                        });
                    }
                });

                const formInputs = document.querySelectorAll('input:not([type="checkbox"]):not([id="repairs"]):not([id="contractedPrice"]):not([id="mao"]):not([id="assignmentFee"]):not([id="arv"]):not([id="percentArv"]):not([id="price"]):not([id="closingCostsBuyPercent"]):not([id="closingCostsSellPercent"]):not([id="buyerAgentCommissionPercent"]):not([id="listingAgentCommissionPercent"]):not([id="holdingCostsDollars"]):not([id="closingCostsDollars"]):not([id="agentCommissionsDollars"]):not([id="sqft"]):not([id="repairCost"]):not([id="trafficCommercialAdjustment"]):not([id="bedroomAdjustment"]):not([id="bathroomAdjustment"]):not([id="garageAdjustment"]):not([id="carportAdjustment"]):not([id="poolAdjustment"]):not([id="holdingPeriodDays"]):not([id="extraValue"]):not([id="investorProfit"]):not([id="bootyMonthlyProfit"]):not([id="bootyRoi"]):not([id="bootyRjRatio"]):not([id="preAssignmentProfit"]):not([id="preAssignmentMonthlyProfit"]):not([id="preAssignmentRoi"]):not([id="preAssignmentRjRatio"]):not([id="totalCosts"]):not([id="adjustedArv"]):not([id="totalAdjustment"]):not([id="iao"]):not([id="yourAssignmentFee"]), select:not([id="jvSplit"]):not([id="majorItems"])');
                formInputs.forEach(input => {
                    input.addEventListener('input', () => {
                        userHasInteracted = true;
                        updateAllFields(false);
                    });
                });

                // Listener for percentArv
                const percentArvInput = document.getElementById('percentArv');
                if (percentArvInput) {
                    percentArvInput.addEventListener('input', () => {
                        userHasInteracted = true;
                        percentArvInput.dataset.manuallyEdited = 'true'; // Mark as manually edited
                        updateAllFields(true);
                    });
                }

                // In setupInputListeners
                const checkboxes = document.querySelectorAll('input[type="checkbox"]');
                checkboxes.forEach(checkbox => {
                    checkbox.addEventListener('change', () => {
                        userHasInteracted = true;
                        if (checkbox.name === 'locationCondition') {
                            updateLocationEstimate(checkbox);
                            updateAllFields(true);
                        } else if (checkbox.name === 'repairCondition') {
                            updateRepairEstimates(checkbox);
                            updateAllFields(true);
                        } else {
                            updateSmartAdjustments(checkbox);
                            updateAllFields(true);
                        }
                    });
                });

                const marketConditionInput = document.getElementById('marketCondition');
                if (marketConditionInput) {
                    marketConditionInput.addEventListener('input', () => {
                        userHasInteracted = true;
                        updateLocationEstimate(null);
                        updateAllFields(true);
                    });
                }

                const majorItemsInput = document.getElementById('majorItems');
                if (majorItemsInput) {
                    majorItemsInput.addEventListener('change', () => {
                        userHasInteracted = true;
                        const majorItems = parseInt(majorItemsInput.value) || 0;
                        const extraField = document.getElementById('extraField');
                        const extraValueInput = document.getElementById('extraValue');
                        extraField.style.display = majorItems > 0 ? 'block' : 'none';
                        if (majorItems > 0 && (!extraValueInput.dataset.manuallyEdited || extraValueInput.dataset.manuallyEdited === 'false')) {
                            extraValueInput.value = formatCurrency(10000);
                            extraValueInput.dataset.manuallyEdited = 'false';
                        } else if (majorItems === 0) {
                            extraValueInput.value = '';
                            extraValueInput.dataset.manuallyEdited = 'false';
                        }
                        updateRepairs();
                        updateAllFields(true);
                    });
                }

                const jvSplitInput = document.getElementById('jvSplit');
                if (jvSplitInput) {
                    jvSplitInput.addEventListener('change', () => {
                        userHasInteracted = true;
                        updateYourAssignmentFee();
                        updateAllFields(true);
                    });
                }
            } catch (error) {
                console.error('Error in setupInputListeners:', error);
            }
        }

        function updatePricingMessage() {
            try {
                if (!userHasInteracted) return;
                const price = parseFloat(document.getElementById('price').value.replace(/[$,]/g, '')) || 0;
                const mao = parseFloat(document.getElementById('mao').value.replace(/[$,]/g, '')) || 0;
                const pricingMessageDiv = document.getElementById('pricingMessage');
                pricingMessageDiv.textContent = '';
                pricingMessageDiv.style.color = '#667085';
                if (mao === 0 || isNaN(price) || isNaN(mao)) return;
                if (mao === price) {
                    pricingMessageDiv.textContent = 'Property is Fairly Priced';
                    pricingMessageDiv.style.color = '#1D2939';
                } else if (mao > price) {
                    const diffPercent = Math.abs((price - mao) / mao);
                    pricingMessageDiv.textContent = `Property is Underpriced by ${(diffPercent * 100).toFixed(2)}%`;
                    pricingMessageDiv.style.color = '#027A48';
                } else {
                    const diffPercent = (price - mao) / mao;
                    pricingMessageDiv.textContent = `Property is Overpriced by ${(diffPercent * 100).toFixed(2)}%`;
                    pricingMessageDiv.style.color = '#D92D20';
                }
            } catch (error) {
                console.error('Error in updatePricingMessage:', error);
            }
        }

        function formatCurrency(value) {
            try {
                if (isNaN(value) || value === null) return '';
                if (value === 0) return '$0';
                const absValue = Math.abs(value);
                const formatted = `$${absValue.toLocaleString()}`;
                return value < 0 ? `-${formatted}` : formatted;
            } catch (error) {
                console.error('Error in formatCurrency:', error);
                return '';
            }
        }

        function applyConditionalFormatting(input, value) {
            try {
                if (!userHasInteracted) return;
                const allowedFields = [
                    'bootyMonthlyProfit', 'bootyRoi', 'bootyRjRatio',
                    'preAssignmentMonthlyProfit', 'preAssignmentRoi', 'preAssignmentRjRatio'
                ];
                if (!allowedFields.includes(input.id)) return;
                input.classList.remove('positive', 'midrange', 'negative', 'blank');
                if (value === '' || isNaN(value)) {
                    input.classList.add('blank');
                    return;
                }
                if (input.id === 'bootyMonthlyProfit' || input.id === 'preAssignmentMonthlyProfit') {
                    if (value > 10000) input.classList.add('positive'); // Green: #D4EDDA
                    else if (value >= 5000 && value <= 10000) input.classList.add('midrange'); // Gray: #E2E3E5
                    else input.classList.add('negative'); // Red: #F8D7DA
                } else if (input.id === 'bootyRoi' || input.id === 'preAssignmentRoi') {
                    if (value > 20) input.classList.add('positive'); // Green: #D4EDDA
                    else if (value >= 10 && value <= 20) input.classList.add('midrange'); // Gray: #E2E3E5
                    else input.classList.add('negative'); // Red: #F8D7DA
                } else if (input.id === 'bootyRjRatio' || input.id === 'preAssignmentRjRatio') {
                    if (value > 80) input.classList.add('positive'); // Green: #D4EDDA
                    else if (value >= 50 && value <= 80) input.classList.add('midrange'); // Gray: #E2E3E5
                    else input.classList.add('negative'); // Red: #F8D7DA
                }
            } catch (error) {
                console.error('Error in applyConditionalFormatting:', error);
            }
        }

        function updateAllFields(dependentFieldChanged = false) {
            try {
                if (!userHasInteracted) {
                    console.log('User has not interacted, skipping updateAllFields');
                    return;
                }
                console.log('Updating all fields...');
                updateRepairs();
                updateSmartAdjustments(null);
                updateTotalAdjustment();
                updateAdjustedARV();
                updateMAO();
                updateXOffer();
                updateDispoFields();
                updateYourAssignmentFee();
                updateClosingCosts();
                updateAllCalculations();
                updateFixAndFlipScore();
                updatePricingMessage();
                console.log('All fields updated');
            } catch (error) {
                console.error('Error in updateAllFields:', error);
            }
        }

        function updateLocationEstimate(checkbox) {
            try {
                const checkboxes = document.querySelectorAll('input[name="locationCondition"]');
                const percentArv = document.getElementById('percentArv');
                const marketCondition = parseInt(document.getElementById('marketCondition').value) || 0;
                let basePercent = 0;
                let checkedValue = '';

                checkboxes.forEach(cb => {
                    if (cb.checked) checkedValue = cb.value;
                });

                if (checkbox) {
                    checkboxes.forEach(cb => {
                        if (cb !== checkbox) cb.checked = false;
                    });
                    checkedValue = checkbox.checked ? checkbox.value : '';
                }

                if (checkedValue) {
                    switch (checkedValue) {
                        case 'bad_area':
                            basePercent = 65;
                            break;
                        case 'good_area':
                            basePercent = 70;
                            break;
                        case 'best_area':
                            basePercent = 75;
                            break;
                    }
                    
                    if (marketCondition === 0) basePercent -= 5;
                    else if (marketCondition === 100) basePercent += 5;
                }

                percentArv.value = checkedValue ? basePercent : '';
            } catch (error) {
                console.error('Error in updateLocationEstimate:', error);
            }
        }

        function updateRepairEstimates(checkbox) {
            try {
                const checkboxes = document.querySelectorAll('input[name="repairCondition"]');
                const repairCost = document.getElementById('repairCost');
                const repairDays = document.getElementById('repairDays');
                const holdingPeriodDays = document.getElementById('holdingPeriodDays');
                const repairsInput = document.getElementById('repairs');
                checkboxes.forEach(cb => {
                    if (cb !== checkbox) cb.checked = false;
                });
                if (checkbox.checked) {
                    switch (checkbox.value) {
                        case 'smoothSailing':
                            repairCost.value = '$0';
                            repairDays.value = '';
                            if (holdingPeriodDays.dataset.manuallyEdited !== 'true') {
                                holdingPeriodDays.value = '90';
                                holdingPeriodDays.dataset.manuallyEdited = 'false';
                            }
                            break;
                        case 'shiverMeetsRepair':
                            repairCost.value = '$20';
                            repairDays.value = '15';
                            if (holdingPeriodDays.dataset.manuallyEdited !== 'true') {
                                holdingPeriodDays.value = '105';
                                holdingPeriodDays.dataset.manuallyEdited = 'false';
                            }
                            break;
                        case 'abandonShip':
                            repairCost.value = '$35';
                            repairDays.value = '30';
                            if (holdingPeriodDays.dataset.manuallyEdited !== 'true') {
                                holdingPeriodDays.value = '120';
                                holdingPeriodDays.dataset.manuallyEdited = 'false';
                            }
                            break;
                        case 'burnTheShip':
                            repairCost.value = '$50';
                            repairDays.value = '90';
                            if (holdingPeriodDays.dataset.manuallyEdited !== 'true') {
                                holdingPeriodDays.value = '180';
                                holdingPeriodDays.dataset.manuallyEdited = 'false';
                            }
                            break;
                    }
                } else {
                    repairCost.value = '';
                    repairDays.value = '';
                    if (holdingPeriodDays.dataset.manuallyEdited !== 'true') {
                        holdingPeriodDays.value = '';
                        holdingPeriodDays.dataset.manuallyEdited = 'false';
                    }
                }
                if (!repairsInput.dataset.manuallyEdited || repairsInput.dataset.manuallyEdited === 'false') {
                    repairsInput.dataset.manuallyEdited = 'false';
                    updateRepairs();
                }
            } catch (error) {
                console.error('Error in updateRepairEstimates:', error);
            }
        }

        function updateRepairs() {
            try {
                const repairsInput = document.getElementById('repairs');
                const sqft = parseFloat(document.getElementById('sqft').value) || 0;
                const repairCostInput = document.getElementById('repairCost');
                const majorItems = parseInt(document.getElementById('majorItems').value) || 0;
                const extraValueInput = document.getElementById('extraValue');
                const extraValue = parseFloat(extraValueInput.value.replace(/[$,]/g, '')) || 0;
                if (repairsInput.dataset.manuallyEdited === 'true') return;
                let costPerSquareFoot = 0;
                const repairCostValue = repairCostInput.value.replace('$', '').trim();
                if (repairCostValue) costPerSquareFoot = parseFloat(repairCostValue) || 0;
                if (sqft > 0) {
                    const totalRepairs = Math.ceil((costPerSquareFoot * sqft) + (majorItems * extraValue));
                    repairsInput.value = formatCurrency(totalRepairs);
                    repairsInput.dataset.manuallyEdited = 'false';
                } else {
                    repairsInput.value = '';
                }
            } catch (error) {
                console.error('Error in updateRepairs:', error);
            }
        }

        function updateSmartAdjustments(checkbox) {
            try {
                const arv = parseFloat(document.getElementById('arv').value.replace(/[$,]/g, '')) || 0;
                const adjustments = ['trafficCommercial', 'bedroom', 'bathroom', 'garage', 'carport', 'pool'];
                adjustments.forEach(groupName => {
                    const adjustmentField = document.getElementById(`${groupName}Adjustment`);
                    const errorField = document.getElementById(`${groupName}Error`);
                    const checkboxes = document.querySelectorAll(`input[name="${groupName}"]`);
                    let checkedCheckbox = document.querySelector(`input[name="${groupName}"]:checked`);

                    // Handle checkbox interaction
                    if (checkbox && checkbox.name === groupName) {
                        // Uncheck other checkboxes in the same group
                        checkboxes.forEach(sibling => {
                            if (sibling !== checkbox) sibling.checked = false;
                        });
                        checkedCheckbox = checkbox.checked ? checkbox : null;
                    }

                    // Check if any checkbox is checked in the group
                    const isAnyChecked = !!checkedCheckbox;

                    // If ARV is 0 and a checkbox is checked, show error and allow unchecking
                    if (!arv && isAnyChecked) {
                        errorField.style.display = 'block';
                        adjustmentField.value = '';
                        checkboxes.forEach(cb => cb.disabled = false); // Ensure checkboxes are interactive
                        return;
                    } else if (!arv && !isAnyChecked) {
                        // Hide error if no checkboxes are checked
                        errorField.style.display = 'none';
                        adjustmentField.value = '';
                        checkboxes.forEach(cb => cb.disabled = false);
                        return;
                    } else {
                        // Hide error if ARV is valid
                        errorField.style.display = 'none';
                        checkboxes.forEach(cb => cb.disabled = false);
                    }

                    // Calculate adjustment if ARV is valid and a checkbox is checked
                    if (checkedCheckbox && arv) {
                        let value = 0;
                        switch (groupName) {
                            case 'trafficCommercial':
                                switch (checkedCheckbox.value) {
                                    case 'backs': value = arv <= 500000 ? -10000 : -(arv * 0.10); break;
                                    case 'fronts': value = arv <= 500000 ? -20000 : -(arv * 0.20); break;
                                    case 'sides': value = arv <= 500000 ? -15000 : -(arv * 0.15); break;
                                    case 'na': value = 0; break;
                                }
                                break;
                            case 'bedroom':
                                value = checkedCheckbox.value === 'shortage' ? -10000 : 10000;
                                break;
                            case 'bathroom':
                                value = checkedCheckbox.value === 'shortage' ? -5000 : 5000;
                                break;
                            case 'garage':
                                value = checkedCheckbox.value === 'shortage' ? -5000 : 5000;
                                break;
                            case 'carport':
                                value = checkedCheckbox.value === 'shortage' ? -2500 : 2500;
                                break;
                            case 'pool':
                                value = checkedCheckbox.value === 'shortage' ? -10000 : 10000;
                                break;
                        }
                        adjustmentField.value = formatCurrency(value);
                    } else {
                        adjustmentField.value = '';
                    }
                });
                updateTotalAdjustment();
            } catch (error) {
                console.error('Error in updateSmartAdjustments:', error);
            }
        }

        function updateTotalAdjustment() {
            try {
                const adjustments = [
                    'trafficCommercialAdjustment', 'bedroomAdjustment',
                    'bathroomAdjustment', 'garageAdjustment', 'carportAdjustment', 'poolAdjustment'
                ];
                let total = 0;
                adjustments.forEach(id => {
                    const field = document.getElementById(id);
                    const valueStr = field.value;
                    if (valueStr) {
                        const cleanedValue = valueStr.replace(/[$,]/g, '');
                        const value = parseFloat(cleanedValue) || 0;
                        total += value;
                    }
                });
                const totalAdjustmentField = document.getElementById('totalAdjustment');
                totalAdjustmentField.value = formatCurrency(total);
                updateAdjustedARV();
            } catch (error) {
                console.error('Error in updateTotalAdjustment:', error);
            }
        }

        function updateAdjustedARV() {
            try {
                const arv = parseFloat(document.getElementById('arv').value.replace(/[$,]/g, '')) || 0;
                const totalAdjustmentStr = document.getElementById('totalAdjustment').value;
                let totalAdjustment = 0;
                if (totalAdjustmentStr) {
                    const cleanedValue = totalAdjustmentStr.replace(/[$,]/g, '');
                    totalAdjustment = parseFloat(cleanedValue) || 0;
                }
                const adjustedArv = arv + totalAdjustment;
                document.getElementById('adjustedArv').value = formatCurrency(adjustedArv);
            } catch (error) {
                console.error('Error in updateAdjustedARV:', error);
            }
        }

        function updateMAO() {
            try {
                const adjustedArv = parseFloat(document.getElementById('adjustedArv').value.replace(/[$,]/g, '')) || 0;
                const percentArv = parseFloat(document.getElementById('percentArv').value) / 100 || 0;
                const repairs = parseFloat(document.getElementById('repairs').value.replace(/[$,]/g, '')) || 0;
                const mao = Math.ceil(adjustedArv * percentArv - repairs);
                document.getElementById('mao').value = formatCurrency(mao);
            } catch (error) {
                console.error('Error in updateMAO:', error);
            }
        }

        function updateXOffer() {
            try {
                const adjustedArv = parseFloat(document.getElementById('adjustedArv').value.replace(/[$,]/g, '')) || 0;
                const repairs = parseFloat(document.getElementById('repairs').value.replace(/[$,]/g, '')) || 0;
                console.log('Adjusted ARV:', adjustedArv, 'Repairs:', repairs);
                let xOffer;
                if (repairs < 30000) {
                    xOffer = adjustedArv * 0.9 - (repairs + 30000) - 20000;
                } else if (repairs > adjustedArv * 0.1) {
                    xOffer = adjustedArv * 0.9 - ((adjustedArv * 0.1) * 2 + (repairs - adjustedArv * 0.1) * 1.5) - 20000;
                } else {
                    xOffer = adjustedArv * 0.9 - (repairs * 2) - 20000;
                }
                console.log('Calculated X Offer:', xOffer);
                document.getElementById('iao').value = formatCurrency(Math.ceil(xOffer));
            } catch (error) {
                console.error('Error in updateXOffer:', error);
            }
        }

        function updateDispoFields() {
            try {
                const contractedPriceInput = document.getElementById('contractedPrice');
                const investorPriceInput = document.getElementById('investorPrice');
                const assignmentFee = document.getElementById('assignmentFee');
                const mao = parseFloat(document.getElementById('mao').value.replace(/[$,]/g, '')) || 0;
                if (!contractedPriceInput.dataset.manuallyEdited || contractedPriceInput.dataset.manuallyEdited === 'false') {
                    contractedPriceInput.value = formatCurrency(Math.ceil(mao - 20000));
                }
                if (!investorPriceInput.dataset.manuallyEdited || investorPriceInput.dataset.manuallyEdited === 'false') {
                    investorPriceInput.value = formatCurrency(Math.ceil(mao));
                }
                const contractedPrice = parseFloat(contractedPriceInput.value.replace(/[$,]/g, '')) || 0;
                const investorPrice = parseFloat(investorPriceInput.value.replace(/[$,]/g, '')) || 0;
                const fee = Math.ceil(investorPrice - contractedPrice);
                assignmentFee.value = formatCurrency(fee);
            } catch (error) {
                console.error('Error in updateDispoFields:', error);
            }
        }

        function updateYourAssignmentFee() {
            try {
                const assignmentFee = parseFloat(document.getElementById('assignmentFee').value.replace(/[$,]/g, '')) || 0;
                const jvSplit = document.getElementById('jvSplit').value;
                let yourShare = assignmentFee;
                if (jvSplit) {
                    const [yourPercent] = jvSplit.split('/').map(Number);
                    yourShare = Math.ceil((yourPercent / 100) * assignmentFee);
                }
                document.getElementById('yourAssignmentFee').value = formatCurrency(yourShare);
            } catch (error) {
                console.error('Error in updateYourAssignmentFee:', error);
            }
        }

        function updateClosingCosts() {
            try {
                const closingCostsDollarsInput = document.getElementById('closingCostsDollars');
                const agentCommissionsDollarsInput = document.getElementById('agentCommissionsDollars');
                const holdingCostsDollarsInput = document.getElementById('holdingCostsDollars');
                const totalCosts = document.getElementById('totalCosts');
                const adjustedArv = parseFloat(document.getElementById('adjustedArv').value.replace(/[$,]/g, '')) || 0;
                const investorPrice = parseFloat(document.getElementById('investorPrice').value.replace(/[$,]/g, '')) || 0;
                const repairs = parseFloat(document.getElementById('repairs').value.replace(/[$,]/g, '')) || 0;
                const closingCostsBuyPercent = parseFloat(document.getElementById('closingCostsBuyPercent').value) / 100 || 0;
                const closingCostsSellPercent = parseFloat(document.getElementById('closingCostsSellPercent').value) / 100 || 0;
                const buyerAgentCommissionPercent = parseFloat(document.getElementById('buyerAgentCommissionPercent').value) / 100 || 0;
                const listingAgentCommissionPercent = parseFloat(document.getElementById('listingAgentCommissionPercent').value) / 100 || 0;
                const holdingPeriodDays = parseFloat(document.getElementById('holdingPeriodDays').value) || 0;

                if (!closingCostsDollarsInput.dataset.manuallyEdited || closingCostsDollarsInput.dataset.manuallyEdited === 'false') {
                    const closingCosts = Math.ceil((investorPrice * closingCostsBuyPercent) + (adjustedArv * closingCostsSellPercent));
                    closingCostsDollarsInput.value = formatCurrency(closingCosts);
                }

                if (!agentCommissionsDollarsInput.dataset.manuallyEdited || agentCommissionsDollarsInput.dataset.manuallyEdited === 'false') {
                    const agentCommissions = Math.ceil(adjustedArv * (buyerAgentCommissionPercent + listingAgentCommissionPercent));
                    agentCommissionsDollarsInput.value = formatCurrency(agentCommissions);
                }

                if (!holdingCostsDollarsInput.dataset.manuallyEdited || holdingCostsDollarsInput.dataset.manuallyEdited === 'false') {
                    const holdingCosts = Math.ceil((holdingPeriodDays / 30) * ((investorPrice + repairs) * 0.004 + (investorPrice * 0.0035)));
                    holdingCostsDollarsInput.value = formatCurrency(holdingCosts);
                }

                const closingCostsDollars = parseFloat(closingCostsDollarsInput.value.replace(/[$,]/g, '')) || 0;
                const agentCommissionsDollars = parseFloat(agentCommissionsDollarsInput.value.replace(/[$,]/g, '')) || 0;
                const holdingCostsDollars = parseFloat(holdingCostsDollarsInput.value.replace(/[$,]/g, '')) || 0;
                const total = Math.ceil(closingCostsDollars + agentCommissionsDollars + holdingCostsDollars + repairs);
                totalCosts.value = formatCurrency(total);
            } catch (error) {
                console.error('Error in updateClosingCosts:', error);
            }
        }
function updateAllCalculations() {
    try {
        const adjustedArv = parseFloat(document.getElementById('adjustedArv').value.replace(/[$,]/g, '')) || 0;
        const investorPrice = parseFloat(document.getElementById('investorPrice').value.replace(/[$,]/g, '')) || 0;
        const contractedPrice = parseFloat(document.getElementById('contractedPrice').value.replace(/[$,]/g, '')) || 0;
        const repairs = parseFloat(document.getElementById('repairs').value.replace(/[$,]/g, '')) || 0;
        const totalCosts = parseFloat(document.getElementById('totalCosts').value.replace(/[$,]/g, '')) || 0;
        const holdingPeriodDays = parseFloat(document.getElementById('holdingPeriodDays').value) || 0;
        const closingCostsBuyPercent = parseFloat(document.getElementById('closingCostsBuyPercent').value) / 100 || 0;
        const closingCostsSellPercent = parseFloat(document.getElementById('closingCostsSellPercent').value) / 100 || 0;
        const closingCostsBuy = Math.ceil(contractedPrice * closingCostsBuyPercent) || 0;
        const closingCostsSell = Math.ceil(adjustedArv * closingCostsSellPercent) || 0;
        const agentCommissionsDollars = parseFloat(document.getElementById('agentCommissionsDollars').value.replace(/[$,]/g, '')) || 0;

        // Investor Profit
        const investorProfitInput = document.getElementById('investorProfit');
        const investorProfit = Math.ceil(adjustedArv - investorPrice - totalCosts);
        investorProfitInput.value = formatCurrency(investorProfit);

        // Booty Calculations
        const bootyMonthlyProfitInput = document.getElementById('bootyMonthlyProfit');
        const bootyRoiInput = document.getElementById('bootyRoi');
        const bootyRjRatioInput = document.getElementById('bootyRjRatio');

        const bootyMonthlyProfit = holdingPeriodDays > 0 ? Math.ceil(investorProfit / (holdingPeriodDays / 30)) : 0;
        bootyMonthlyProfitInput.value = formatCurrency(bootyMonthlyProfit);

        const bootyRoi = (investorPrice + repairs) > 0 ? Math.ceil((investorProfit / (investorPrice + repairs)) * 100) : 0;
        bootyRoiInput.value = bootyRoi !== 0 ? `${bootyRoi}%` : '';

        const bootyRjRatio = repairs > 0 ? Math.ceil((investorProfit / repairs) * 100) : 0;
        bootyRjRatioInput.value = bootyRjRatio !== 0 ? `${bootyRjRatio}%` : '';

        // Pre-Assignment Profit Calculations
        const preAssignmentProfitInput = document.getElementById('preAssignmentProfit');
        const holdingCosts = holdingPeriodDays > 0 ? Math.ceil((holdingPeriodDays / 30) * ((contractedPrice + repairs) * 0.004 + (contractedPrice * 0.0035))) : 0;
        const preAssignmentProfit = Math.ceil(adjustedArv - contractedPrice - (closingCostsBuy + closingCostsSell) - agentCommissionsDollars - holdingCosts - repairs);
        preAssignmentProfitInput.value = formatCurrency(preAssignmentProfit);

        const preAssignmentMonthlyProfitInput = document.getElementById('preAssignmentMonthlyProfit');
        const preAssignmentRoiInput = document.getElementById('preAssignmentRoi');
        const preAssignmentRjRatioInput = document.getElementById('preAssignmentRjRatio');

        const preAssignmentMonthlyProfit = holdingPeriodDays > 0 ? Math.ceil(preAssignmentProfit / (holdingPeriodDays / 30)) : 0;
        preAssignmentMonthlyProfitInput.value = formatCurrency(preAssignmentMonthlyProfit);

        const preAssignmentRoi = (contractedPrice + repairs) > 0 ? Math.ceil((preAssignmentProfit / (contractedPrice + repairs)) * 100) : 0;
        preAssignmentRoiInput.value = preAssignmentRoi !== 0 ? `${preAssignmentRoi}%` : '';

        const preAssignmentRjRatio = repairs > 0 ? Math.ceil((preAssignmentProfit / repairs) * 100) : 0;
        preAssignmentRjRatioInput.value = preAssignmentRjRatio !== 0 ? `${preAssignmentRjRatio}%` : '';

        // Apply Conditional Formatting
        applyConditionalFormatting(bootyMonthlyProfitInput, bootyMonthlyProfit);
        applyConditionalFormatting(bootyRoiInput, bootyRoi);
        applyConditionalFormatting(bootyRjRatioInput, bootyRjRatio);
        applyConditionalFormatting(preAssignmentMonthlyProfitInput, preAssignmentMonthlyProfit);
        applyConditionalFormatting(preAssignmentRoiInput, preAssignmentRoi);
        applyConditionalFormatting(preAssignmentRjRatioInput, preAssignmentRjRatio);
    } catch (error) {
        console.error('Error in updateAllCalculations:', error);
    }
}

function applyConditionalFormatting(input, value) {
    try {
        if (!userHasInteracted) return;
        const allowedFields = [
            'bootyMonthlyProfit', 'bootyRoi', 'bootyRjRatio',
            'preAssignmentMonthlyProfit', 'preAssignmentRoi', 'preAssignmentRjRatio'
        ];
        if (!allowedFields.includes(input.id)) return;
        input.classList.remove('positive', 'midrange', 'negative', 'blank');
        if (value === '' || isNaN(value)) {
            input.classList.add('blank');
            return;
        }
        if (input.id === 'bootyMonthlyProfit' || input.id === 'preAssignmentMonthlyProfit') {
            if (value >= 10000) input.classList.add('positive'); // Green: #D4EDDA
            else if (value >= 5000 && value < 10000) input.classList.add('midrange'); // Gray: #E2E3E5
            else input.classList.add('negative'); // Red: #F8D7DA
        } else if (input.id === 'bootyRoi' || input.id === 'preAssignmentRoi') {
            if (value >= 20) input.classList.add('positive'); // Green: #D4EDDA
            else if (value >= 10 && value < 20) input.classList.add('midrange'); // Gray: #E2E3E5
            else input.classList.add('negative'); // Red: #F8D7DA
        } else if (input.id === 'bootyRjRatio' || input.id === 'preAssignmentRjRatio') {
            if (value > 80) input.classList.add('positive'); // Green: #D4EDDA
            else if (value >= 50 && value <= 80) input.classList.add('midrange'); // Gray: #E2E3E5
            else input.classList.add('negative'); // Red: #F8D7DA
        }
    } catch (error) {
        console.error('Error in applyConditionalFormatting:', error);
    }
}

function updateFixAndFlipScore() {
    try {
        if (!userHasInteracted) {
            console.log('User has not interacted, skipping updateFixAndFlipScore');
            return;
        }
        const preAssignmentProfit = parseFloat(document.getElementById('preAssignmentProfit').value.replace(/[$,]/g, '')) || 0;
        const preAssignmentMonthlyProfit = parseFloat(document.getElementById('preAssignmentMonthlyProfit').value.replace(/[$,]/g, '')) || 0;
        const preAssignmentRoi = parseFloat(document.getElementById('preAssignmentRoi').value.replace(/%/g, '')) || 0;
        const preAssignmentRjRatio = parseFloat(document.getElementById('preAssignmentRjRatio').value.replace(/%/g, '')) || 0;

        let score = 0; // Start at 0, max 10 points

        // Pre-Assignment Profit Score
        if (preAssignmentProfit >= 30000) score += 1;

        // Pre-Assignment Monthly Profit Score
        if (preAssignmentMonthlyProfit >= 10000) score += 3;
        else if (preAssignmentMonthlyProfit >= 5000 && preAssignmentMonthlyProfit < 10000) score += 1.5;

        // Pre-Assignment ROI Score
        if (preAssignmentRoi >= 20) score += 3;
        else if (preAssignmentRoi >= 10 && preAssignmentRoi < 20) score += 1.5;

        // Pre-Assignment RJ Ratio Score
        if (preAssignmentRjRatio >= 80) score += 3;
        else if (preAssignmentRjRatio >= 50 && preAssignmentRjRatio < 80) score += 1.5;

        
        const fixAndFlipScore = document.getElementById('fixAndFlipScore');
        // Display score as a fraction out of 10
        fixAndFlipScore.value = score !== 0 ? `${score}/10` : '';
        console.log(`Fix and Flip Score updated: ${score}/10`);
    } catch (error) {
        console.error('Error in updateFixAndFlipScore:', error);
    }
}

</script>
</body>
</html>
